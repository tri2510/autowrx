# SDV Deployment Feature for AutoWRX

## Overview

This feature extends AutoWRX with comprehensive Software Defined Vehicle (SDV) deployment capabilities, enabling developers to deploy Python vehicle applications from the web IDE directly to any SDV-compatible device.

## Key Features

- **üöÄ One-Click Deployment**: Deploy Python apps from web browser to real automotive devices
- **üîç Auto-Discovery**: Automatically find compatible devices on the network
- **üîó Kuksa Integration**: Seamless vehicle communication via Kuksa Databroker
- **üîÑ Hot-Swapping**: Update applications without vehicle downtime
- **üì± Multi-Device Support**: Jetson Orin, Linux systems, automotive prototypes
- **üõ°Ô∏è Sandboxing**: Secure app execution with resource limits
- **üìä Real-time Monitoring**: Track deployment progress and app health

## Architecture Components

### Frontend Components
- **SDVDeploymentHub**: Main deployment orchestration interface
- **DaAppPackager**: Creates deployment-ready packages from Python code
- **DaDeviceScanner**: Discovers and manages SDV-compatible devices
- **DaKuksaConfig**: Configures Kuksa Databroker integration
- **DaDeploymentManager**: Orchestrates multi-device deployment

### Backend/Device Components
- **Device Agent**: Manages app lifecycle on target devices
- **Package Manager**: Handles app installation and updates
- **Resource Manager**: Enforces sandboxing and resource limits
- **Health Monitor**: Tracks app status and performance

## Supported Devices

- **NVIDIA Jetson Orin**: GPU-accelerated edge AI devices
- **Generic Linux**: Any Linux system with Docker or native Python
- **Automotive Prototypes**: Custom ECUs and development boards
- **Future Devices**: Extensible architecture for new automotive hardware

## Deployment Workflow

1. **Development**: Create Python vehicle app in AutoWRX web IDE
2. **Packaging**: Configure app metadata and deployment settings
3. **Device Selection**: Auto-discover and select target devices
4. **Kuksa Setup**: Configure vehicle communication (auto-discover + fallback)
5. **Deployment**: One-click deployment to selected devices
6. **Monitoring**: Real-time progress tracking and health checks

## Quick Start

### For Developers

1. **Create Your Python App**:
   ```python
   # Generated by AutoWRX AI
   import asyncio
   from kuksa_client import KuksaClient

   class MyVehicleApp:
       async def on_start(self):
           # Subscribe to vehicle signals
           await self.kuksa.subscribe("Vehicle.Cabin.Door.IsOpen", self.on_door_change)

       async def on_door_change(self, data):
           if data.value:
               # Control vehicle systems
               await self.kuksa.set("Vehicle.Cabin.Lights.Mode", "ON")
   ```

2. **Open SDV Deployment Hub**:
   - Navigate to your prototype in AutoWRX
   - Click the "Deploy to SDV Devices" button
   - Follow the step-by-step wizard

3. **Configure Deployment**:
   - Set app name and version
   - Choose runtime mode (Docker/native)
   - Configure resource limits
   - Set Kuksa integration options

4. **Select Devices**:
   - Auto-scan discovers compatible devices
   - Review device capabilities
   - Select target devices for deployment

5. **Deploy**:
   - Click "Deploy to Devices"
   - Monitor real-time progress
   - View deployment results

### For Device Setup

1. **Install Device Agent**:
   ```bash
   # Download device agent
   wget https://autowrx.io/device-agent/latest/device-agent.py

   # Install dependencies
   pip install aiohttp docker psutil

   # Start agent
   python device-agent.py --mode production
   ```

2. **Install Docker (optional)**:
   ```bash
   curl -fsSL https://get.docker.com -o get-docker.sh
   sh get-docker.sh
   sudo usermod -aG docker $USER
   ```

3. **Install Kuksa Databroker (optional)**:
   ```bash
   # Download and start Kuksa
   wget https://github.com/eclipse/kuksa.val/releases/latest/download/kuksa-databroker.tar.gz
   tar -xzf kuksa-databroker.tar.gz
   ./kuksa-databroker --vss /path/to/vss.json
   ```

## Technical Documentation

- **[Architecture Overview](SDV_DEPLOYMENT_ARCHITECTURE.md)**: Complete system design and component relationships
- **[Implementation Guide](SDV_IMPLEMENTATION_GUIDE.md)**: Detailed technical specifications and code examples
- **[API Reference](API_REFERENCE.md)**: REST API endpoints and data structures
- **[Device Agent Guide](DEVICE_AGENT_GUIDE.md)**: Setting up and configuring device agents

## File Structure

```
frontend/src/components/
‚îú‚îÄ‚îÄ organisms/
‚îÇ   ‚îî‚îÄ‚îÄ SDVDeploymentHub.tsx          # Main deployment interface
‚îî‚îÄ‚îÄ molecules/deployment/
    ‚îú‚îÄ‚îÄ DaAppPackager.tsx             # App packaging component
    ‚îú‚îÄ‚îÄ DaDeviceScanner.tsx           # Device discovery component
    ‚îú‚îÄ‚îÄ DaKuksaConfig.tsx             # Kuksa configuration component
    ‚îî‚îÄ‚îÄ DaDeploymentManager.tsx       # Deployment orchestration component

device-agent/
‚îú‚îÄ‚îÄ device_agent.py                   # Main device agent
‚îú‚îÄ‚îÄ package_manager.py                # Package installation/updates
‚îú‚îÄ‚îÄ resource_manager.py               # Resource management
‚îú‚îÄ‚îÄ health_monitor.py                 # Health monitoring
‚îî‚îÄ‚îÄ config/
    ‚îî‚îÄ‚îÄ default.json                  # Default configuration

docs/
‚îú‚îÄ‚îÄ SDV_DEPLOYMENT_ARCHITECTURE.md    # Architecture overview
‚îú‚îÄ‚îÄ SDV_IMPLEMENTATION_GUIDE.md       # Implementation details
‚îú‚îÄ‚îÄ API_REFERENCE.md                  # API documentation
‚îî‚îÄ‚îÄ DEVICE_AGENT_GUIDE.md             # Device setup guide
```

## Configuration

### App Package Configuration
```json
{
  "app": {
    "name": "my-vehicle-app",
    "version": "1.0.0",
    "runtimeMode": "docker",
    "entryPoint": "app.py"
  },
  "kuksaConfig": {
    "brokerAutoDetect": true,
    "fallbackBroker": true,
    "vssVersion": "latest"
  },
  "deployment": {
    "hotSwap": true,
    "otaEnabled": true,
    "resourceLimits": {
      "memory": "512MB",
      "cpu": "0.5"
    }
  },
  "security": {
    "sandboxLevel": "basic",
    "dataAccess": "open"
  }
}
```

### Device Agent Configuration
```json
{
  "runtime_mode": "docker",
  "kuksa_endpoint": "auto",
  "max_apps": 10,
  "resource_pool": {
    "total_memory": "8GB",
    "total_cpu": "4"
  },
  "security": {
    "enable_sandboxing": true,
    "network_isolation": true
  },
  "monitoring": {
    "health_check_interval": 30,
    "metrics_collection": true
  }
}
```

## Security Features

### Current Implementation
- **App Sandboxing**: Resource limits and isolation
- **Network Isolation**: Kuksa-only access by default
- **User Permissions**: Role-based access control
- **Package Validation**: Code and configuration verification

### Future Extensions
- **ISO 21434**: Automotive cybersecurity compliance
- **Encrypted Communication**: TLS/SSL for all communications
- **Advanced Access Control**: Signal-level permissions
- **Audit Logging**: Security event tracking and reporting

## Monitoring and Observability

### Health Monitoring
- App lifecycle status tracking
- Kuksa connection monitoring
- Resource usage metrics
- Error detection and alerting

### Metrics Collection
- Deployment success rates
- App performance metrics
- Device resource utilization
- Network latency measurements

### Logging
- Structured logging with correlation IDs
- Log aggregation and search
- Performance profiling data
- Security event logging

## Troubleshooting

### Common Issues

**Device Not Discovered**:
```bash
# Check network connectivity
ping <device-ip>

# Verify device agent is running
ssh <device-ip> "ps aux | grep device-agent"

# Check firewall settings
sudo ufw status
```

**Kuksa Connection Failed**:
```bash
# Test broker connectivity
mosquitto_pub -h <broker-ip> -t test -m "hello"

# Check broker logs
sudo journalctl -u kuksa-databroker -f
```

**App Deployment Failed**:
```bash
# Check device logs
ssh <device-ip> "tail -f /var/log/autowrx/deployment.log"

# Verify Docker status
ssh <device-ip> "docker ps -a"
```

### Debug Commands

```bash
# Device agent status
python device-agent.py --status

# List deployed apps
python device-agent.py --list-apps

# Check app health
python device-agent.py --health-check <app-id>

# View app logs
python device-agent.py --logs <app-id>
```

## Contributing

### Development Setup

1. **Clone Repository**:
   ```bash
   git clone https://github.com/tri2510/autowrx.git
   cd autowrx
   git checkout feature/sdv-deployment-architecture
   ```

2. **Install Dependencies**:
   ```bash
   # Frontend
   cd frontend
   npm install

   # Device Agent
   cd device-agent
   pip install -r requirements.txt
   ```

3. **Run Tests**:
   ```bash
   # Frontend tests
   cd frontend
   npm test

   # Device agent tests
   cd device-agent
   pytest tests/
   ```

### Code Style

- **TypeScript**: Follow existing AutoWRX patterns
- **Python**: PEP 8 compliance with type hints
- **Documentation**: JSDoc for frontend, docstrings for backend
- **Testing**: Unit tests with >80% coverage

## Roadmap

### Phase 1: Core Deployment Engine ‚úÖ
- [x] Architecture design
- [x] Component specifications
- [x] API definitions
- [ ] Component implementation
- [ ] Basic deployment workflow

### Phase 2: Advanced Features üöß
- [ ] Hot-swapping implementation
- [ ] Version management system
- [ ] Multi-app orchestration
- [ ] Resource monitoring
- [ ] Health checking

### Phase 3: Production Ready üìã
- [ ] OTA update system
- [ ] Security hardening
- [ ] Performance optimization
- [ ] Error handling
- [ ] Documentation

### Phase 4: Future Extensions üîÆ
- [ ] Cloud connectivity
- [ ] Advanced security
- [ ] AI-powered optimization
- [ ] Custom device support
- [ ] Automotive compliance

## Support

- **Documentation**: See `docs/` directory for detailed guides
- **Issues**: Report bugs and feature requests on GitHub
- **Community**: Join discussions in the AutoWRX community
- **Support**: Contact the development team at support@autowrx.io

## License

This feature is part of the AutoWRX project and is licensed under the MIT License. See the [LICENSE](../LICENSE) file for details.

---

**Note**: This is currently a design and architecture specification. Implementation is in progress and will be available in upcoming releases.