# Copyright (c) 2025 Eclipse Foundation.
#
# This program and the accompanying materials are made available under the
# terms of the MIT License which is available at
# https://opensource.org/licenses/MIT.
#
# SPDX-License-Identifier: MIT

# AutoWRX Development Environment
# Usage:
#   docker compose -f docker-compose.dev.yml up

services:
  # AutoWRX Backend - Development mode with hot reload
  autowrx:
    build:
      context: .
      dockerfile: ./backend/Dockerfile.dev
    container_name: ${NAME:-dev}-autowrx
    command: yarn dev
    volumes:
      - ./backend:/usr/src/playground-be
      - /usr/src/playground-be/node_modules
      - '${UPLOAD_PATH_HOST:-./data/upload}:/opt/data/upload'
    ports:
      - "${PORT:-3200}:3200"
    environment:
      NODE_ENV: development
      PORT: 3200
      MONGODB_URL: mongodb://autowrx-db:27017/autowrx
      JWT_SECRET: ${JWT_SECRET:-dev_secret_change_me}
      STRICT_AUTH: ${STRICT_AUTH:-false}
      JWT_COOKIE_NAME: ${JWT_COOKIE_NAME:-token}
      CORS_ORIGINS: ${CORS_ORIGINS:-localhost:\\d+,127\\.0\\.0\\.1:\\d+}
      ADMIN_EMAILS: ${ADMIN_EMAILS:-}
      ADMIN_PASSWORD: ${ADMIN_PASSWORD:-}
    depends_on:
      - autowrx-db
    networks:
      - autowrx-network
    restart: unless-stopped

  # MongoDB - Database
  autowrx-db:
    platform: linux/amd64
    container_name: ${NAME:-dev}-autowrx-db
    image: mongo:4.4.6-bionic
    ports:
      - "${MONGODB_PORT:-27017}:27017"
    volumes:
      - autowrx-dbdata:/data/db
    networks:
      - autowrx-network
    restart: unless-stopped

volumes:
  autowrx-dbdata:
    name: ${NAME:-dev}-autowrx-dbdata

networks:
  autowrx-network:
    name: ${NAME:-dev}-autowrx-network
    driver: bridge

