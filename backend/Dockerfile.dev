# Copyright (c) 2025 Eclipse Foundation.
#
# This program and the accompanying materials are made available under the
# terms of the MIT License which is available at
# https://opensource.org/licenses/MIT.
#
# SPDX-License-Identifier: MIT

# Dockerfile for Development - Backend only (no frontend build)
# Frontend runs separately with hot reload

FROM node:20-alpine

# Install Python and build tools needed for native dependencies (bufferutil, utf-8-validate)
RUN apk add --no-cache python3 make g++

RUN mkdir -p /usr/src/playground-be && chown -R node:node /usr/src/playground-be

WORKDIR /usr/src/playground-be

COPY backend/package.json backend/yarn.lock ./

RUN yarn install --frozen-lockfile

# Remove build tools to reduce image size
RUN apk del make g++

COPY --chown=node:node backend/ .

USER node

EXPOSE 3200

ENV PORT=3200

CMD ["yarn", "dev"]

